/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
import{createRectsFromDOMRange as e,$cloneWithProperties as t}from"@lexical/selection";import{$getSelection as n,$isRangeSelection as o,TextNode as r,$getRoot as l,$isElementNode as i,$isTextNode as s,$setSelection as c,$getPreviousSelection as u,$isRootOrShadowRoot as f,$splitNode as d,$createParagraphNode as a}from"lexical";export{$splitNode,isHTMLAnchorElement,isHTMLElement}from"lexical";var g=function(e){const t=new URLSearchParams;t.append("code",e);for(let e=1;e<arguments.length;e++)t.append("v",arguments[e]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)};const p="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,h=p&&"documentMode"in document?document.documentMode:null;p&&/Mac|iPod|iPhone|iPad/.test(navigator.platform);const m=p&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);p&&"InputEvent"in window&&!h&&new window.InputEvent("input"),p&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),p&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream;p&&/Android/.test(navigator.userAgent),p&&/^(?=.*Chrome).*/i.test(navigator.userAgent);function E(...e){const t=[];for(const n of e)if(n&&"string"==typeof n)for(const[e]of n.matchAll(/\S+/g))t.push(e);return t}function v(...e){return()=>{e.forEach((e=>e()))}}function w(e){return`${e}px`}p&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent);const y={attributes:!0,characterData:!0,childList:!0,subtree:!0};function x(t,n,o){let r=null,l=null,i=null,s=[];const c=document.createElement("div");function u(){if(null===r)throw Error("Unexpected null rootDOMNode");if(null===l)throw Error("Unexpected null parentDOMNode");const{left:i,top:u}=r.getBoundingClientRect(),f=l,d=e(t,n);c.isConnected||f.append(c);let a=!1;for(let e=0;e<d.length;e++){const t=d[e],n=s[e]||document.createElement("div"),o=n.style;"absolute"!==o.position&&(o.position="absolute",a=!0);const r=w(t.left-i);o.left!==r&&(o.left=r,a=!0);const l=w(t.top-u);o.top!==l&&(n.style.top=l,a=!0);const f=w(t.width);o.width!==f&&(n.style.width=f,a=!0);const g=w(t.height);o.height!==g&&(n.style.height=g,a=!0),n.parentNode!==c&&(c.append(n),a=!0),s[e]=n}for(;s.length>d.length;)s.pop();a&&o(s)}function f(){l=null,r=null,null!==i&&i.disconnect(),i=null,c.remove();for(const e of s)e.remove();s=[]}const d=t.registerRootListener((function e(){const n=t.getRootElement();if(null===n)return f();const o=n.parentElement;if(!(o instanceof HTMLElement))return f();f(),r=n,l=o,i=new MutationObserver((n=>{const o=t.getRootElement(),i=o&&o.parentElement;if(o!==r||i!==l)return e();for(const e of n)if(!c.contains(e.target))return u()})),i.observe(o,y),u()}));return()=>{d(),f()}}function N(e,t){let l=null,i=null,s=null,c=null,u=()=>{};function f(f){f.read((()=>{const f=n();if(!o(f))return l=null,i=null,s=null,c=null,u(),void(u=()=>{});const{anchor:d,focus:a}=f,g=d.getNode(),p=g.getKey(),h=d.offset,m=a.getNode(),E=m.getKey(),v=a.offset,y=e.getElementByKey(p),N=e.getElementByKey(E),P=null===l||null===y||h!==i||p!==l.getKey()||g!==l&&(!(l instanceof r)||g.updateDOM(l,y,e._config)),S=null===s||null===N||v!==c||E!==s.getKey()||m!==s&&(!(s instanceof r)||m.updateDOM(s,N,e._config));if(P||S){const n=e.getElementByKey(d.getNode().getKey()),o=e.getElementByKey(a.getNode().getKey());if(null!==n&&null!==o&&"SPAN"===n.tagName&&"SPAN"===o.tagName){const r=document.createRange();let l,i,s,c;a.isBefore(d)?(l=o,i=a.offset,s=n,c=d.offset):(l=n,i=d.offset,s=o,c=a.offset);const f=l.firstChild;if(null===f)throw Error("Expected text node to be first child of span");const g=s.firstChild;if(null===g)throw Error("Expected text node to be first child of span");r.setStart(f,i),r.setEnd(g,c),u(),u=x(e,r,(e=>{for(const t of e){const e=t.style;"Highlight"!==e.background&&(e.background="Highlight"),"HighlightText"!==e.color&&(e.color="HighlightText"),"-1"!==e.zIndex&&(e.zIndex="-1"),"none"!==e.pointerEvents&&(e.pointerEvents="none"),e.marginTop!==w(-1.5)&&(e.marginTop=w(-1.5)),e.paddingTop!==w(4)&&(e.paddingTop=w(4)),e.paddingBottom!==w(0)&&(e.paddingBottom=w(0))}void 0!==t&&t(e)}))}}l=g,i=h,s=m,c=v}))}return f(e.getEditorState()),v(e.registerUpdateListener((({editorState:e})=>f(e))),u,(()=>{u()}))}function P(e,...t){const n=E(...t);n.length>0&&e.classList.add(...n)}function S(e,...t){const n=E(...t);n.length>0&&e.classList.remove(...n)}function A(e,t){for(const n of t)if(e.type.startsWith(n))return!0;return!1}function b(e,t){const n=e[Symbol.iterator]();return new Promise(((e,o)=>{const r=[],l=()=>{const{done:i,value:s}=n.next();if(i)return e(r);const c=new FileReader;c.addEventListener("error",o),c.addEventListener("load",(()=>{const e=c.result;"string"==typeof e&&r.push({file:s,result:e}),l()})),A(s,t)?c.readAsDataURL(s):l()};l()}))}function L(e,t){const n=[],o=(e||l()).getLatest(),r=t||(i(o)?o.getLastDescendant():o);let s=o,c=function(e){let t=e,n=0;for(;null!==(t=t.getParent());)n++;return n}(s);for(;null!==s&&!s.is(r);)if(n.push({depth:c,node:s}),i(s)&&s.getChildrenSize()>0)s=s.getFirstChild(),c++;else{let e=null;for(;null===e&&null!==s;)e=s.getNextSibling(),null===e?(s=s.getParent(),c--):s=e}return null!==s&&s.is(r)&&n.push({depth:c,node:s}),n}function M(e,t){let n=e;for(;null!=n;){if(n instanceof t)return n;n=n.getParent()}return null}function T(e){const t=_(e,(e=>i(e)&&!e.isInline()));return i(t)||g(4,e.__key),t}const _=(e,t)=>{let n=e;for(;n!==l()&&null!=n;){if(t(n))return n;n=n.getParent()}return null};function B(e,t,n,o){const r=e=>e instanceof t;return e.registerNodeTransform(t,(e=>{const t=(e=>{const t=e.getChildren();for(let e=0;e<t.length;e++){const n=t[e];if(r(n))return null}let n=e,o=e;for(;null!==n;)if(o=n,n=n.getParent(),r(n))return{child:o,parent:n};return null})(e);if(null!==t){const{child:r,parent:l}=t;if(r.is(e)){o(l,e);const t=r.getNextSiblings(),i=t.length;if(l.insertAfter(r),0!==i){const e=n(l);r.insertAfter(e);for(let n=0;n<i;n++)e.append(t[n])}l.canBeEmpty()||0!==l.getChildrenSize()||l.remove()}}}))}function C(e,n){const o=new Map,r=e._pendingEditorState;for(const[e,r]of n._nodeMap){const n=t(r);if(s(n)){if(!s(r))throw Error("Expected node be a TextNode");n.__text=r.__text}o.set(e,n)}r&&(r._nodeMap=o),e._dirtyType=2;const l=n._selection;c(null===l?null:l.clone())}function K(e){const t=n()||u();if(o(t)){const{focus:n}=t,o=n.getNode(),r=n.offset;if(f(o)){const t=o.getChildAtIndex(r);null==t?o.append(e):t.insertBefore(e),e.selectNext()}else{let t,n;s(o)?(t=o.getParentOrThrow(),n=o.getIndexWithinParent(),r>0&&(n+=1,o.splitText(r))):(t=o,n=r);const[,l]=d(t,n);l.insertBefore(e),l.selectStart()}}else{if(null!=t){const n=t.getNodes();n[n.length-1].getTopLevelElementOrThrow().insertAfter(e)}else{l().append(e)}const n=a();e.insertAfter(n),n.select()}return e.getLatest()}function O(e,t){const n=t();return e.replace(n),n.append(e),n}function R(e,t){return null!==e&&Object.getPrototypeOf(e).constructor.name===t.name}function D(e,t){const n=[];for(let o=0;o<e.length;o++){const r=t(e[o]);null!==r&&n.push(r)}return n}function H(e,t){const n=e.getFirstChild();null!==n?n.insertBefore(t):e.append(t)}function I(e){if(m)return 1;let t=1;for(;e;)t*=Number(window.getComputedStyle(e).getPropertyValue("zoom")),e=e.parentElement;return t}export{L as $dfs,D as $filter,_ as $findMatchingParent,T as $getNearestBlockElementAncestorOrThrow,M as $getNearestNodeOfType,H as $insertFirst,K as $insertNodeToNearestRoot,C as $restoreEditorState,O as $wrapNodeInElement,P as addClassNamesToElement,I as calculateZoomLevel,A as isMimeType,N as markSelection,b as mediaFileReader,v as mergeRegister,R as objectKlassEquals,x as positionNodeOnRange,B as registerNestedElementResolver,S as removeClassNamesFromElement};
