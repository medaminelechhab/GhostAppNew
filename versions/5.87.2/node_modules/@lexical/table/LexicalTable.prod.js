/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';var g=require("@lexical/utils"),u=require("lexical");let aa=/^(\d+(?:\.\d+)?)px$/,x={BOTH:3,COLUMN:2,NO_STATUS:0,ROW:1};
class y extends u.ElementNode{static getType(){return"tablecell"}static clone(a){let b=new y(a.__headerState,a.__colSpan,a.__width,a.__key);b.__rowSpan=a.__rowSpan;b.__backgroundColor=a.__backgroundColor;return b}static importDOM(){return{td:()=>({conversion:ba,priority:0}),th:()=>({conversion:ba,priority:0})}}static importJSON(a){let b=a.rowSpan||1,c=z(a.headerState,a.colSpan||1,a.width||void 0);c.__rowSpan=b;c.__backgroundColor=a.backgroundColor||null;return c}constructor(a=x.NO_STATUS,b=1,c,d){super(d);
this.__colSpan=b;this.__rowSpan=1;this.__headerState=a;this.__width=c;this.__backgroundColor=null}createDOM(a){let b=document.createElement(this.getTag());this.__width&&(b.style.width=`${this.__width}px`);1<this.__colSpan&&(b.colSpan=this.__colSpan);1<this.__rowSpan&&(b.rowSpan=this.__rowSpan);null!==this.__backgroundColor&&(b.style.backgroundColor=this.__backgroundColor);g.addClassNamesToElement(b,a.theme.tableCell,this.hasHeader()&&a.theme.tableCellHeader);return b}exportDOM(a){({element:a}=super.exportDOM(a));
if(a){var b=this.getParentOrThrow().getChildrenSize();a.style.border="1px solid black";1<this.__colSpan&&(a.colSpan=this.__colSpan);1<this.__rowSpan&&(a.rowSpan=this.__rowSpan);a.style.width=`${this.getWidth()||Math.max(90,700/b)}px`;a.style.verticalAlign="top";a.style.textAlign="start";b=this.getBackgroundColor();null!==b?a.style.backgroundColor=b:this.hasHeader()&&(a.style.backgroundColor="#f2f3f5")}return{element:a}}exportJSON(){return{...super.exportJSON(),backgroundColor:this.getBackgroundColor(),
colSpan:this.__colSpan,headerState:this.__headerState,rowSpan:this.__rowSpan,type:"tablecell",width:this.getWidth()}}getColSpan(){return this.__colSpan}setColSpan(a){this.getWritable().__colSpan=a;return this}getRowSpan(){return this.__rowSpan}setRowSpan(a){this.getWritable().__rowSpan=a;return this}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(a){this.getWritable().__headerState=a;return this.__headerState}getHeaderStyles(){return this.getLatest().__headerState}setWidth(a){this.getWritable().__width=
a;return this.__width}getWidth(){return this.getLatest().__width}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(a){this.getWritable().__backgroundColor=a}toggleHeaderStyle(a){let b=this.getWritable();b.__headerState=(b.__headerState&a)===a?b.__headerState-a:b.__headerState+a;return b}hasHeaderState(a){return(this.getHeaderStyles()&a)===a}hasHeader(){return this.getLatest().__headerState!==x.NO_STATUS}updateDOM(a){return a.__headerState!==this.__headerState||a.__width!==
this.__width||a.__colSpan!==this.__colSpan||a.__rowSpan!==this.__rowSpan||a.__backgroundColor!==this.__backgroundColor}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}}
function ba(a){var b=a.nodeName.toLowerCase();let c=void 0;aa.test(a.style.width)&&(c=parseFloat(a.style.width));b=z("th"===b?x.ROW:x.NO_STATUS,a.colSpan,c);b.__rowSpan=a.rowSpan;a=a.style.backgroundColor;""!==a&&(b.__backgroundColor=a);return{after:d=>{0===d.length&&d.push(u.$createParagraphNode());return d},forChild:(d,e)=>{if(B(e)&&!u.$isElementNode(d)){e=u.$createParagraphNode();if(u.$isLineBreakNode(d)&&"\n"===d.getTextContent())return null;e.append(d);return e}return d},node:b}}
function z(a,b=1,c){return u.$applyNodeReplacement(new y(a,b,c))}function B(a){return a instanceof y}let ca=u.createCommand("INSERT_TABLE_COMMAND");
class C extends u.ElementNode{static getType(){return"tablerow"}static clone(a){return new C(a.__height,a.__key)}static importDOM(){return{tr:()=>({conversion:fa,priority:0})}}static importJSON(a){return D(a.height)}constructor(a,b){super(b);this.__height=a}exportJSON(){return{...super.exportJSON(),...(this.getHeight()&&{height:this.getHeight()}),type:"tablerow",version:1}}createDOM(a){let b=document.createElement("tr");this.__height&&(b.style.height=`${this.__height}px`);g.addClassNamesToElement(b,
a.theme.tableRow);return b}isShadowRoot(){return!0}setHeight(a){this.getWritable().__height=a;return this.__height}getHeight(){return this.getLatest().__height}updateDOM(a){return a.__height!==this.__height}canBeEmpty(){return!1}canIndent(){return!1}}function fa(a){let b=void 0;aa.test(a.style.height)&&(b=parseFloat(a.style.height));return{node:D(b)}}function D(a){return u.$applyNodeReplacement(new C(a))}function H(a){return a instanceof C}
function J(a){let b=new URLSearchParams;b.append("code",a);for(let c=1;c<arguments.length;c++)b.append("v",arguments[c]);throw Error(`Minified Lexical error #${a}; visit https://lexical.dev/docs/error?${b} for the full message or `+"use the non-minified dev environment for full errors and additional helpful warnings.");}let ha="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;
function ia(a){a=g.$findMatchingParent(a,b=>H(b));if(H(a))return a;throw Error("Expected table cell to be inside of table row.");}function ja(a){a=g.$findMatchingParent(a,b=>K(b));if(K(a))return a;throw Error("Expected table cell to be inside of table.");}function ka(a,b){let c=ja(a),{x:d,y:e}=c.getCordsFromCellNode(a,b);return{above:c.getCellNodeFromCords(d,e-1,b),below:c.getCellNodeFromCords(d,e+1,b),left:c.getCellNodeFromCords(d-1,e,b),right:c.getCellNodeFromCords(d+1,e,b)}}
let la=(a,b)=>a===x.BOTH||a===b?b:x.NO_STATUS;function N(a){let b=a.getFirstDescendant();null==b?a.selectStart():b.getParentOrThrow().selectStart()}function ma(a,b){let c=a.getFirstChild();null!==c?c.insertBefore(b):a.append(b)}
function O(a,b,c){let d=[],e=null,h=null;a=a.getChildren();for(let t=0;t<a.length;t++){var f=a[t];H(f)||J(146);var m=f.getChildren();f=0;for(let k of m){for(B(k)||J(147);void 0!==d[t]&&void 0!==d[t][f];)f++;m=t;var q=f,r=k;let l={cell:r,startColumn:q,startRow:m},n=r.__rowSpan,p=r.__colSpan;for(let w=0;w<n;w++){void 0===d[m+w]&&(d[m+w]=[]);for(let v=0;v<p;v++)d[m+w][q+v]=l}b.is(r)&&(e=l);c.is(r)&&(h=l);f+=k.__colSpan}}null===e&&J(110);null===h&&J(111);return[d,e,h]}
function P(a){a instanceof y||("__type"in a?(a=g.$findMatchingParent(a,B),B(a)||J(148)):(a=g.$findMatchingParent(a.getNode(),B),B(a)||J(148)));let b=a.getParent();H(b)||J(149);let c=b.getParent();K(c)||J(150);return[a,b,c]}
function na(a){let [b,,c]=P(a);a=c.getChildren();let d=a.length;var e=a[0].getChildren().length;let h=Array(d);for(var f=0;f<d;f++)h[f]=Array(e);for(e=0;e<d;e++){f=a[e].getChildren();let m=0;for(let q=0;q<f.length;q++){for(;h[e][m];)m++;let r=f[q],t=r.__rowSpan||1,k=r.__colSpan||1;for(let l=0;l<t;l++)for(let n=0;n<k;n++)h[e+l][m+n]=r;if(b===r)return{colSpan:k,columnIndex:m,rowIndex:e,rowSpan:t};m+=k}}return null}
class oa{constructor(a,b,c){this.anchor=b;this.focus=c;b._selection=this;c._selection=this;this._cachedNodes=null;this.dirty=!1;this.tableKey=a}getStartEndPoints(){return[this.anchor,this.focus]}isBackward(){return this.focus.isBefore(this.anchor)}getCachedNodes(){return this._cachedNodes}setCachedNodes(a){this._cachedNodes=a}is(a){return Q(a)?this.tableKey===a.tableKey&&this.anchor.is(a.anchor)&&this.focus.is(a.focus):!1}set(a,b,c){this.dirty=!0;this.tableKey=a;this.anchor.key=b;this.focus.key=c;
this._cachedNodes=null}clone(){return new oa(this.tableKey,this.anchor,this.focus)}isCollapsed(){return!1}extract(){return this.getNodes()}insertRawText(){}insertText(){}insertNodes(a){let b=this.focus.getNode();u.$isElementNode(b)||J(151);u.$normalizeSelection__EXPERIMENTAL(b.select(0,b.getChildrenSize())).insertNodes(a)}getShape(){var a=u.$getNodeByKey(this.anchor.key);B(a)||J(152);a=na(a);null===a&&J(153);var b=u.$getNodeByKey(this.focus.key);B(b)||J(154);let c=na(b);null===c&&J(155);b=Math.min(a.columnIndex,
c.columnIndex);let d=Math.max(a.columnIndex,c.columnIndex),e=Math.min(a.rowIndex,c.rowIndex);a=Math.max(a.rowIndex,c.rowIndex);return{fromX:Math.min(b,d),fromY:Math.min(e,a),toX:Math.max(b,d),toY:Math.max(e,a)}}getNodes(){function a(w){let {cell:v,startColumn:A,startRow:E}=w;q=Math.min(q,A);r=Math.min(r,E);t=Math.max(t,A+v.__colSpan-1);k=Math.max(k,E+v.__rowSpan-1)}var b=this._cachedNodes;if(null!==b)return b;var c=this.anchor.getNode();b=this.focus.getNode();var d=g.$findMatchingParent(c,B);c=g.$findMatchingParent(b,
B);B(d)||J(152);B(c)||J(154);b=d.getParent();H(b)||J(156);b=b.getParent();K(b)||J(157);var e=c.getParents()[1];if(e!==b)return b.isParentOf(c)?(b=e.getParent(),null==b&&J(159),this.set(this.tableKey,c.getKey(),b.getKey())):(b=b.getParent(),null==b&&J(158),this.set(this.tableKey,b.getKey(),c.getKey())),this.getNodes();let [h,f,m]=O(b,d,c),q=Math.min(f.startColumn,m.startColumn),r=Math.min(f.startRow,m.startRow),t=Math.max(f.startColumn+f.cell.__colSpan-1,m.startColumn+m.cell.__colSpan-1),k=Math.max(f.startRow+
f.cell.__rowSpan-1,m.startRow+m.cell.__rowSpan-1);c=q;d=r;e=q;for(var l=r;q<c||r<d||t>e||k>l;){if(q<c){var n=l-d;--c;for(var p=0;p<=n;p++)a(h[d+p][c])}if(r<d)for(n=e-c,--d,p=0;p<=n;p++)a(h[d][c+p]);if(t>e)for(n=l-d,e+=1,p=0;p<=n;p++)a(h[d+p][e]);if(k>l)for(n=e-c,l+=1,p=0;p<=n;p++)a(h[l][c+p])}b=[b];c=null;for(d=r;d<=k;d++)for(e=q;e<=t;e++)({cell:l}=h[d][e]),n=l.getParent(),H(n)||J(160),n!==c&&b.push(n),b.push(l,...pa(l)),c=n;u.isCurrentlyReadOnlyMode()||(this._cachedNodes=b);return b}getTextContent(){let a=
this.getNodes(),b="";for(let c=0;c<a.length;c++)b+=a[c].getTextContent();return b}}function Q(a){return a instanceof oa}function R(){let a=u.$createPoint("root",0,"element"),b=u.$createPoint("root",0,"element");return new oa("root",a,b)}function pa(a){let b=[],c=[a];for(;0<c.length;){let d=c.pop();void 0===d&&J(112);u.$isElementNode(d)&&c.unshift(...d.getChildren());d!==a&&b.push(d)}return b}
class qa{constructor(a,b){this.isHighlightingCells=!1;this.focusY=this.focusX=this.anchorY=this.anchorX=-1;this.listenersToRemove=new Set;this.tableNodeKey=b;this.editor=a;this.table={columns:0,domRows:[],rows:0};this.focusCell=this.anchorCell=this.focusCellNodeKey=this.anchorCellNodeKey=this.tableSelection=null;this.hasHijackedSelectionStyles=!1;this.trackTable();this.isSelecting=!1}getTable(){return this.table}removeListeners(){Array.from(this.listenersToRemove).forEach(a=>a())}trackTable(){let a=
new MutationObserver(b=>{this.editor.update(()=>{var c=!1;for(let d=0;d<b.length;d++){const e=b[d].target.nodeName;if("TABLE"===e||"TR"===e){c=!0;break}}if(c){c=this.editor.getElementByKey(this.tableNodeKey);if(!c)throw Error("Expected to find TableElement in DOM");this.table=S(c)}})});this.editor.update(()=>{let b=this.editor.getElementByKey(this.tableNodeKey);if(!b)throw Error("Expected to find TableElement in DOM");this.table=S(b);a.observe(b,{childList:!0,subtree:!0})})}clearHighlight(){let a=
this.editor;this.isHighlightingCells=!1;this.focusY=this.focusX=this.anchorY=this.anchorX=-1;this.focusCell=this.anchorCell=this.focusCellNodeKey=this.anchorCellNodeKey=this.tableSelection=null;this.hasHijackedSelectionStyles=!1;this.enableHighlightStyle();a.update(()=>{var b=u.$getNodeByKey(this.tableNodeKey);if(!K(b))throw Error("Expected TableNode.");b=a.getElementByKey(this.tableNodeKey);if(!b)throw Error("Expected to find TableElement in DOM");b=S(b);ra(a,b,null);u.$setSelection(null);a.dispatchCommand(u.SELECTION_CHANGE_COMMAND,
void 0)})}enableHighlightStyle(){let a=this.editor;a.update(()=>{let b=a.getElementByKey(this.tableNodeKey);if(!b)throw Error("Expected to find TableElement in DOM");g.removeClassNamesFromElement(b,a._config.theme.tableSelection);b.classList.remove("disable-selection");this.hasHijackedSelectionStyles=!1})}disableHighlightStyle(){let a=this.editor;a.update(()=>{let b=a.getElementByKey(this.tableNodeKey);if(!b)throw Error("Expected to find TableElement in DOM");g.addClassNamesToElement(b,a._config.theme.tableSelection);
this.hasHijackedSelectionStyles=!0})}updateTableTableSelection(a){if(null!==a&&a.tableKey===this.tableNodeKey){let b=this.editor;this.tableSelection=a;this.isHighlightingCells=!0;this.disableHighlightStyle();ra(b,this.table,this.tableSelection)}else null==a?this.clearHighlight():(this.tableNodeKey=a.tableKey,this.updateTableTableSelection(a))}setFocusCellForSelection(a,b=!1){let c=this.editor;c.update(()=>{var d=u.$getNodeByKey(this.tableNodeKey);if(!K(d))throw Error("Expected TableNode.");if(!c.getElementByKey(this.tableNodeKey))throw Error("Expected to find TableElement in DOM");
var e=a.x;let h=a.y;this.focusCell=a;if(null!==this.anchorCell){let f=ha?(c._window||window).getSelection():null;f&&f.setBaseAndExtent(this.anchorCell.elem,0,this.focusCell.elem,0)}if(!this.isHighlightingCells&&(this.anchorX!==e||this.anchorY!==h||b))this.isHighlightingCells=!0,this.disableHighlightStyle();else if(e===this.focusX&&h===this.focusY)return;this.focusX=e;this.focusY=h;this.isHighlightingCells&&(e=u.$getNearestNodeFromDOMNode(a.elem),null!=this.tableSelection&&null!=this.anchorCellNodeKey&&
B(e)&&d.is(T(e))&&(d=e.getKey(),this.tableSelection=this.tableSelection.clone()||R(),this.focusCellNodeKey=d,this.tableSelection.set(this.tableNodeKey,this.anchorCellNodeKey,this.focusCellNodeKey),u.$setSelection(this.tableSelection),c.dispatchCommand(u.SELECTION_CHANGE_COMMAND,void 0),ra(c,this.table,this.tableSelection)))})}setAnchorCellForSelection(a){this.isHighlightingCells=!1;this.anchorCell=a;this.anchorX=a.x;this.anchorY=a.y;this.editor.update(()=>{var b=u.$getNearestNodeFromDOMNode(a.elem);
B(b)&&(b=b.getKey(),this.tableSelection=null!=this.tableSelection?this.tableSelection.clone():R(),this.anchorCellNodeKey=b)})}formatCells(a){this.editor.update(()=>{let b=u.$getSelection();Q(b)||J(11);let c=u.$createRangeSelection(),d=c.anchor,e=c.focus;b.getNodes().forEach(h=>{B(h)&&0!==h.getTextContentSize()&&(d.set(h.getKey(),0,"element"),e.set(h.getKey(),h.getChildrenSize(),"element"),c.formatText(a))});u.$setSelection(b);this.editor.dispatchCommand(u.SELECTION_CHANGE_COMMAND,void 0)})}clearText(){let a=
this.editor;a.update(()=>{let b=u.$getNodeByKey(this.tableNodeKey);if(!K(b))throw Error("Expected TableNode.");var c=u.$getSelection();Q(c)||J(11);c=c.getNodes().filter(B);c.length===this.table.columns*this.table.rows?(b.selectPrevious(),b.remove(),u.$getRoot().selectStart()):(c.forEach(d=>{if(u.$isElementNode(d)){let e=u.$createParagraphNode(),h=u.$createTextNode();e.append(h);d.append(e);d.getChildren().forEach(f=>{f!==e&&f.remove()})}}),ra(a,this.table,null),u.$setSelection(null),a.dispatchCommand(u.SELECTION_CHANGE_COMMAND,
void 0))})}}function sa(a){for(;null!=a;){let b=a.nodeName;if("TD"===b||"TH"===b){a=a._cell;if(void 0===a)break;return a}a=a.parentNode}return null}
function S(a){let b=[],c={columns:0,domRows:b,rows:0};var d=a.firstChild;let e=a=0;for(b.length=0;null!=d;){var h=d.nodeName;if("TD"===h||"TH"===h){h=d;h={elem:h,hasBackgroundColor:""!==h.style.backgroundColor,highlighted:!1,x:a,y:e};d._cell=h;let f=b[e];void 0===f&&(f=b[e]=[]);f[a]=h}else if(h=d.firstChild,null!=h){d=h;continue}h=d.nextSibling;if(null!=h)a++,d=h;else if(h=d.parentNode,null!=h){d=h.nextSibling;if(null==d)break;e++;a=0}}c.columns=a+1;c.rows=e+1;return c}
function ra(a,b,c){let d=new Set(c?c.getNodes():[]);ta(b,(e,h)=>{let f=e.elem;d.has(h)?(e.highlighted=!0,ua(a,e)):(e.highlighted=!1,va(a,e),f.getAttribute("style")||f.removeAttribute("style"))})}function ta(a,b){({domRows:a}=a);for(let c=0;c<a.length;c++){let d=a[c];if(d)for(let e=0;e<d.length;e++){let h=d[e];if(!h)continue;let f=u.$getNearestNodeFromDOMNode(h.elem);null!==f&&b(h,f,{x:e,y:c})}}}function wa(a,b){b.disableHighlightStyle();ta(b.table,c=>{c.highlighted=!0;ua(a,c)})}
function xa(a,b){b.enableHighlightStyle();ta(b.table,c=>{let d=c.elem;c.highlighted=!1;va(a,c);d.getAttribute("style")||d.removeAttribute("style")})}
let ya=(a,b,c,d,e)=>{const h="forward"===e;switch(e){case "backward":case "forward":return c!==(h?a.table.columns-1:0)?(a=b.getCellNodeFromCordsOrThrow(c+(h?1:-1),d,a.table),h?a.selectStart():a.selectEnd()):d!==(h?a.table.rows-1:0)?(a=b.getCellNodeFromCordsOrThrow(h?0:a.table.columns-1,d+(h?1:-1),a.table),h?a.selectStart():a.selectEnd()):h?b.selectNext():b.selectPrevious(),!0;case "up":return 0!==d?b.getCellNodeFromCordsOrThrow(c,d-1,a.table).selectEnd():b.selectPrevious(),!0;case "down":return d!==
a.table.rows-1?b.getCellNodeFromCordsOrThrow(c,d+1,a.table).selectStart():b.selectNext(),!0;default:return!1}},za=(a,b,c,d,e)=>{const h="forward"===e;switch(e){case "backward":case "forward":return c!==(h?a.table.columns-1:0)&&a.setFocusCellForSelection(b.getDOMCellFromCordsOrThrow(c+(h?1:-1),d,a.table)),!0;case "up":return 0!==d?(a.setFocusCellForSelection(b.getDOMCellFromCordsOrThrow(c,d-1,a.table)),!0):!1;case "down":return d!==a.table.rows-1?(a.setFocusCellForSelection(b.getDOMCellFromCordsOrThrow(c,
d+1,a.table)),!0):!1;default:return!1}};function U(a,b){if(u.$isRangeSelection(a)||Q(a)){let c=b.isParentOf(a.anchor.getNode());a=b.isParentOf(a.focus.getNode());return c&&a}return!1}
function ua(a,b){a=b.elem;b=u.$getNearestNodeFromDOMNode(a);B(b)||J(131);null===b.getBackgroundColor()?a.style.setProperty("background-color","rgb(172,206,247)"):a.style.setProperty("background-image","linear-gradient(to right, rgba(172,206,247,0.85), rgba(172,206,247,0.85))");a.style.setProperty("caret-color","transparent")}
function va(a,b){a=b.elem;b=u.$getNearestNodeFromDOMNode(a);B(b)||J(131);null===b.getBackgroundColor()&&a.style.removeProperty("background-color");a.style.removeProperty("background-image");a.style.removeProperty("caret-color")}function Ba(a){a=g.$findMatchingParent(a,B);return B(a)?a:null}function T(a){a=g.$findMatchingParent(a,K);return K(a)?a:null}
function Y(a,b,c,d,e){var h=u.$getSelection();if(!U(h,d)){if("backward"===c&&u.$isRangeSelection(h)&&h.isCollapsed()){c=h.anchor.type;d=h.anchor.offset;if("element"!==c&&("text"!==c||0!==d))return!1;c=h.anchor.getNode();if(!c)return!1;c=g.$findMatchingParent(c,q=>u.$isElementNode(q)&&!q.isInline());if(!c)return!1;c=c.getPreviousSibling();if(!c||!K(c))return!1;Z(b);c.selectEnd();return!0}return!1}if(u.$isRangeSelection(h)&&h.isCollapsed()){let {anchor:q,focus:r}=h;var f=g.$findMatchingParent(q.getNode(),
B),m=g.$findMatchingParent(r.getNode(),B);if(!B(f)||!f.is(m))return!1;m=T(f);if(m!==d&&null!=m&&(h=a.getElementByKey(m.getKey()),null!=h))return e.table=S(h),Y(a,b,c,m,e);if("backward"===c||"forward"===c)return e=q.type,a=q.offset,(f=q.getNode())?Ca(e,a,f,c)?Da(b,f,d,c):!1:!1;m=a.getElementByKey(f.__key);h=a.getElementByKey(q.key);if(null==h||null==m)return!1;if("element"===q.type)m=h.getBoundingClientRect();else{m=window.getSelection();if(null===m||0===m.rangeCount)return!1;m=m.getRangeAt(0).getBoundingClientRect()}h=
"up"===c?f.getFirstChild():f.getLastChild();if(null==h)return!1;a=a.getElementByKey(h.__key);if(null==a)return!1;a=a.getBoundingClientRect();if("up"===c?a.top>m.top-m.height:m.bottom+m.height>a.bottom){Z(b);a=d.getCordsFromCellNode(f,e.table);if(b.shiftKey)b=d.getDOMCellFromCordsOrThrow(a.x,a.y,e.table),e.setAnchorCellForSelection(b),e.setFocusCellForSelection(b,!0);else return ya(e,d,a.x,a.y,c);return!0}}else if(Q(h)){let {anchor:q,focus:r}=h,t=g.$findMatchingParent(q.getNode(),B);m=g.$findMatchingParent(r.getNode(),
B);[f]=h.getNodes();a=a.getElementByKey(f.getKey());if(!B(t)||!B(m)||!K(f)||null==a)return!1;e.updateTableTableSelection(h);a=S(a);h=d.getCordsFromCellNode(t,a);h=d.getDOMCellFromCordsOrThrow(h.x,h.y,a);e.setAnchorCellForSelection(h);Z(b);if(b.shiftKey)return b=d.getCordsFromCellNode(m,a),za(e,f,b.x,b.y,c);m.selectEnd();return!0}return!1}function Z(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation()}
function Ca(a,b,c,d){return"element"===a&&("backward"===d?null===c.getPreviousSibling():null===c.getNextSibling())||Ea(a,b,c,d)}function Ea(a,b,c,d){let e=g.$findMatchingParent(c,h=>u.$isElementNode(h)&&!h.isInline());if(!e)return!1;b="backward"===d?0===b:b===c.getTextContentSize();return"text"===a&&b&&("backward"===d?null===e.getPreviousSibling():null===e.getNextSibling())}
function Da(a,b,c,d){var e=g.$findMatchingParent(b,B);if(!B(e))return!1;let [h,f]=O(c,e,e);e=h[0][0];let m=h[h.length-1][h[0].length-1],{startColumn:q,startRow:r}=f;if("backward"===d?q!==e.startColumn||r!==e.startRow:q!==m.startColumn||r!==m.startRow)return!1;b=Fa(b,d,c);if(!b||K(b))return!1;Z(a);"backward"===d?b.selectEnd():b.selectStart();return!0}
function Fa(a,b,c){if(a=g.$findMatchingParent(a,d=>u.$isElementNode(d)&&!d.isInline()))return(a="backward"===b?a.getPreviousSibling():a.getNextSibling())&&K(a)?a:"backward"===b?c.getPreviousSibling():c.getNextSibling()}function Ga(a,b,c){let d=u.$createParagraphNode();"first"===a?b.insertBefore(d):b.insertAfter(d);d.append(...(c||[]));d.selectEnd()}
function Ha(a,b,c){let d=window.getSelection();if(d&&d.anchorNode===a.getRootElement()&&(a=g.$findMatchingParent(b.anchor.getNode(),q=>B(q)))&&(b=g.$findMatchingParent(a,q=>K(q)),K(b)&&b.is(c))){var [e,h]=O(c,a,a);c=e[0][0];a=e[e.length-1][e[0].length-1];var {startRow:f,startColumn:m}=h;if(f===c.startRow&&m===c.startColumn)return"first";if(f===a.startRow&&m===a.startColumn)return"last"}}
class Ia extends u.ElementNode{static getType(){return"table"}static clone(a){return new Ia(a.__key)}static importDOM(){return{table:()=>({conversion:Ja,priority:1})}}static importJSON(){return Ka()}constructor(a){super(a)}exportJSON(){return{...super.exportJSON(),type:"table",version:1}}createDOM(a){let b=document.createElement("table");g.addClassNamesToElement(b,a.theme.table);return b}updateDOM(){return!1}exportDOM(a){return{...super.exportDOM(a),after:b=>{if(b){let c=b.cloneNode(),d=document.createElement("colgroup"),
e=document.createElement("tbody");g.isHTMLElement(b)&&e.append(...b.children);b=this.getFirstChildOrThrow();if(!H(b))throw Error("Expected to find row node.");b=b.getChildrenSize();for(let h=0;h<b;h++){let f=document.createElement("col");d.append(f)}c.replaceChildren(d,e);return c}}}}canBeEmpty(){return!1}isShadowRoot(){return!0}getCordsFromCellNode(a,b){let {rows:c,domRows:d}=b;for(b=0;b<c;b++){var e=d[b];if(null!=e&&(e=e.findIndex(h=>{if(h)return{elem:h}=h,u.$getNearestNodeFromDOMNode(h)===a}),
-1!==e))return{x:e,y:b}}throw Error("Cell not found in table.");}getDOMCellFromCords(a,b,c){({domRows:c}=c);b=c[b];if(null==b)return null;a=b[a];return null==a?null:a}getDOMCellFromCordsOrThrow(a,b,c){a=this.getDOMCellFromCords(a,b,c);if(!a)throw Error("Cell not found at cords.");return a}getCellNodeFromCords(a,b,c){a=this.getDOMCellFromCords(a,b,c);if(null==a)return null;a=u.$getNearestNodeFromDOMNode(a.elem);return B(a)?a:null}getCellNodeFromCordsOrThrow(a,b,c){a=this.getCellNodeFromCords(a,b,c);
if(!a)throw Error("Node at cords not TableCellNode.");return a}canSelectBefore(){return!0}canIndent(){return!1}}function Ja(){return{node:Ka()}}function Ka(){return u.$applyNodeReplacement(new Ia)}function K(a){return a instanceof Ia}exports.$computeTableMap=O;exports.$createTableCellNode=z;exports.$createTableNode=Ka;
exports.$createTableNodeWithDimensions=function(a,b,c=!0){let d=Ka();for(let h=0;h<a;h++){let f=D();for(let m=0;m<b;m++){var e=x.NO_STATUS;"object"===typeof c?(0===h&&c.rows&&(e|=x.ROW),0===m&&c.columns&&(e|=x.COLUMN)):c&&(0===h&&(e|=x.ROW),0===m&&(e|=x.COLUMN));e=z(e);let q=u.$createParagraphNode();q.append(u.$createTextNode());e.append(q);f.append(e)}d.append(f)}return d};exports.$createTableRowNode=D;exports.$createTableSelection=R;
exports.$deleteTableColumn=function(a,b){let c=a.getChildren();for(let e=0;e<c.length;e++){var d=c[e];if(H(d)){d=d.getChildren();if(b>=d.length||0>b)throw Error("Table column target index out of range");d[b].remove()}}return a};
exports.$deleteTableColumn__EXPERIMENTAL=function(){var a=u.$getSelection();u.$isRangeSelection(a)||Q(a)||J(118);var b=a.anchor.getNode();a=a.focus.getNode();let [c,,d]=P(b);[b]=P(a);let [e,h,f]=O(d,c,b);var {startColumn:m}=h;let {startRow:q,startColumn:r}=f;a=Math.min(m,r);m=Math.max(m+c.__colSpan-1,r+b.__colSpan-1);let t=m-a+1;if(e[0].length===m-a+1)d.selectPrevious(),d.remove();else{var k=e.length;for(let l=0;l<k;l++)for(let n=a;n<=m;n++){let {cell:p,startColumn:w}=e[l][n];w<a?n===a&&p.setColSpan(p.__colSpan-
Math.min(t,p.__colSpan-(a-w))):w+p.__colSpan-1>m?n===m&&p.setColSpan(p.__colSpan-(m-w+1)):p.remove()}a=e[q];b=a[r+b.__colSpan];void 0!==b?({cell:b}=b,N(b)):({cell:b}=a[r-1],N(b))}};
exports.$deleteTableRow__EXPERIMENTAL=function(){var a=u.$getSelection();u.$isRangeSelection(a)||Q(a)||J(118);var b=a.anchor.getNode();a=a.focus.getNode();let [c,,d]=P(b);[a]=P(a);let [e,h,f]=O(d,c,a);({startRow:b}=h);var {startRow:m}=f;a=m+a.__rowSpan-1;if(e.length===a-b+1)d.remove();else{m=e[0].length;var q=e[a+1],r=d.getChildAtIndex(a+1);for(let k=a;k>=b;k--){for(var t=m-1;0<=t;t--){let {cell:l,startRow:n,startColumn:p}=e[k][t];if(p===t&&(k===b&&n<b&&l.setRowSpan(l.__rowSpan-(n-b)),n>=b&&n+l.__rowSpan-
1>a))if(l.setRowSpan(l.__rowSpan-(a-n+1)),null===r&&J(122),0===t)ma(r,l);else{let {cell:w}=q[t-1];w.insertAfter(l)}}t=d.getChildAtIndex(k);H(t)||J(123,String(k));t.remove()}void 0!==q?({cell:b}=q[0],N(b)):({cell:b}=e[b-1][0],N(b))}};exports.$getElementForTableNode=function(a,b){a=a.getElementByKey(b.getKey());if(null==a)throw Error("Table Element Not Found");return S(a)};exports.$getNodeTriplet=P;
exports.$getTableCellNodeFromLexicalNode=function(a){a=g.$findMatchingParent(a,b=>B(b));return B(a)?a:null};exports.$getTableCellNodeRect=na;exports.$getTableColumnIndexFromTableCellNode=function(a){return ia(a).getChildren().findIndex(b=>b.is(a))};exports.$getTableNodeFromLexicalNodeOrThrow=ja;exports.$getTableRowIndexFromTableCellNode=function(a){let b=ia(a);return ja(b).getChildren().findIndex(c=>c.is(b))};exports.$getTableRowNodeFromTableCellNodeOrThrow=ia;
exports.$insertTableColumn=function(a,b,c=!0,d,e){let h=a.getChildren(),f=[];for(let r=0;r<h.length;r++){let t=h[r];if(H(t))for(let k=0;k<d;k++){var m=t.getChildren();if(b>=m.length||0>b)throw Error("Table column target index out of range");m=m[b];B(m)||J(12);let {left:l,right:n}=ka(m,e);var q=x.NO_STATUS;if(l&&l.hasHeaderState(x.ROW)||n&&n.hasHeaderState(x.ROW))q|=x.ROW;q=z(q);q.append(u.$createParagraphNode());f.push({newTableCell:q,targetCell:m})}}f.forEach(({newTableCell:r,targetCell:t})=>{c?
t.insertAfter(r):t.insertBefore(r)});return a};
exports.$insertTableColumn__EXPERIMENTAL=function(a=!0){function b(k=x.NO_STATUS){k=z(k).append(u.$createParagraphNode());null===r&&(r=k);return k}var c=u.$getSelection();u.$isRangeSelection(c)||Q(c)||J(118);var d=c.anchor.getNode();c=c.focus.getNode();[d]=P(d);let [e,,h]=P(c),[f,m,q]=O(h,e,d);d=f.length;c=a?Math.max(m.startColumn,q.startColumn):Math.min(m.startColumn,q.startColumn);a=a?c+e.__colSpan-1:c-1;c=h.getFirstChild();H(c)||J(120);let r=null;var t=c;a:for(c=0;c<d;c++){0!==c&&(t=t.getNextSibling(),
H(t)||J(121));let k=f[c],l=la(k[0>a?0:a].cell.__headerState,x.ROW);if(0>a){ma(t,b(l));continue}let {cell:n,startColumn:p,startRow:w}=k[a];if(p+n.__colSpan-1<=a){let v=n,A=w,E=a;for(;A!==c&&1<v.__rowSpan;)if(E-=n.__colSpan,0<=E){let {cell:F,startRow:G}=k[E];v=F;A=G}else{t.append(b(l));continue a}v.insertAfter(b(l))}else n.setColSpan(n.__colSpan+1)}null!==r&&N(r)};
exports.$insertTableRow=function(a,b,c=!0,d,e){var h=a.getChildren();if(b>=h.length||0>b)throw Error("Table row target index out of range");b=h[b];if(H(b))for(h=0;h<d;h++){let m=b.getChildren(),q=m.length,r=D();for(let t=0;t<q;t++){var f=m[t];B(f)||J(12);let {above:k,below:l}=ka(f,e);f=x.NO_STATUS;let n=k&&k.getWidth()||l&&l.getWidth()||void 0;if(k&&k.hasHeaderState(x.COLUMN)||l&&l.hasHeaderState(x.COLUMN))f|=x.COLUMN;f=z(f,1,n);f.append(u.$createParagraphNode());r.append(f)}c?b.insertAfter(r):b.insertBefore(r)}else throw Error("Row before insertion index does not exist.");
return a};
exports.$insertTableRow__EXPERIMENTAL=function(a=!0){var b=u.$getSelection();u.$isRangeSelection(b)||Q(b)||J(118);b=b.focus.getNode();let [c,,d]=P(b),[e,h]=O(d,c,c);b=e[0].length;var {startRow:f}=h;if(a){a=f+c.__rowSpan-1;var m=e[a];f=D();for(var q=0;q<b;q++){let {cell:t,startRow:k}=m[q];if(k+t.__rowSpan-1<=a){var r=la(m[q].cell.__headerState,x.COLUMN);f.append(z(r).append(u.$createParagraphNode()))}else t.setRowSpan(t.__rowSpan+1)}b=d.getChildAtIndex(a);H(b)||J(145);b.insertAfter(f)}else{m=e[f];
a=D();for(q=0;q<b;q++){let {cell:t,startRow:k}=m[q];k===f?(r=la(m[q].cell.__headerState,x.COLUMN),a.append(z(r).append(u.$createParagraphNode()))):t.setRowSpan(t.__rowSpan+1)}b=d.getChildAtIndex(f);H(b)||J(145);b.insertBefore(a)}};exports.$isTableCellNode=B;exports.$isTableNode=K;exports.$isTableRowNode=H;exports.$isTableSelection=Q;exports.$removeTableRowAtIndex=function(a,b){let c=a.getChildren();if(b>=c.length||0>b)throw Error("Expected table cell to be inside of table row.");c[b].remove();return a};
exports.$unmergeCell=function(){var a=u.$getSelection();u.$isRangeSelection(a)||Q(a)||J(118);a=a.anchor.getNode();let [b,c,d]=P(a);a=b.__colSpan;let e=b.__rowSpan;if(1<a){for(var h=1;h<a;h++)b.insertAfter(z(x.NO_STATUS));b.setColSpan(1)}if(1<e){let [q,r]=O(d,b,b),{startColumn:t,startRow:k}=r,l;for(h=1;h<e;h++){var f=k+h;let n=q[f];l=(l||c).getNextSibling();H(l)||J(125);var m=null;for(let p=0;p<t;p++){let w=n[p],v=w.cell;w.startRow===f&&(m=v);1<v.__colSpan&&(p+=v.__colSpan-1)}if(null===m)for(m=0;m<
a;m++)ma(l,z(x.NO_STATUS));else for(f=0;f<a;f++)m.insertAfter(z(x.NO_STATUS))}b.setRowSpan(1)}};exports.INSERT_TABLE_COMMAND=ca;exports.TableCellHeaderStates=x;exports.TableCellNode=y;exports.TableNode=Ia;exports.TableObserver=qa;exports.TableRowNode=C;
exports.applyTableHandlers=function(a,b,c,d){function e(k){k=a.getCordsFromCellNode(k,f.table);return a.getDOMCellFromCordsOrThrow(k.x,k.y,f.table)}let h=c.getRootElement();if(null===h)throw Error("No root element.");let f=new qa(c,a.getKey()),m=c._window||window;b.__lexicalTableSelection=f;let q=()=>{const k=()=>{f.isSelecting=!1;m.removeEventListener("mouseup",k);m.removeEventListener("mousemove",l)},l=n=>{const p=sa(n.target);null===p||f.anchorX===p.x&&f.anchorY===p.y||(n.preventDefault(),f.setFocusCellForSelection(p))};
return{onMouseMove:l,onMouseUp:k}};b.addEventListener("mousedown",k=>{setTimeout(()=>{if(0===k.button&&m){var l=sa(k.target);null!==l&&(Z(k),f.setAnchorCellForSelection(l));var {onMouseUp:n,onMouseMove:p}=q();f.isSelecting=!0;m.addEventListener("mouseup",n);m.addEventListener("mousemove",p)}},0)});let r=k=>{0===k.button&&c.update(()=>{const l=u.$getSelection(),n=k.target;Q(l)&&l.tableKey===f.tableNodeKey&&h.contains(n)&&f.clearHighlight()})};m.addEventListener("mousedown",r);f.listenersToRemove.add(()=>
m.removeEventListener("mousedown",r));f.listenersToRemove.add(c.registerCommand(u.KEY_ARROW_DOWN_COMMAND,k=>Y(c,k,"down",a,f),u.COMMAND_PRIORITY_HIGH));f.listenersToRemove.add(c.registerCommand(u.KEY_ARROW_UP_COMMAND,k=>Y(c,k,"up",a,f),u.COMMAND_PRIORITY_HIGH));f.listenersToRemove.add(c.registerCommand(u.KEY_ARROW_LEFT_COMMAND,k=>Y(c,k,"backward",a,f),u.COMMAND_PRIORITY_HIGH));f.listenersToRemove.add(c.registerCommand(u.KEY_ARROW_RIGHT_COMMAND,k=>Y(c,k,"forward",a,f),u.COMMAND_PRIORITY_HIGH));f.listenersToRemove.add(c.registerCommand(u.KEY_ESCAPE_COMMAND,
k=>{var l=u.$getSelection();return Q(l)&&(l=g.$findMatchingParent(l.focus.getNode(),B),B(l))?(Z(k),l.selectEnd(),!0):!1},u.COMMAND_PRIORITY_HIGH));let t=k=>()=>{var l=u.$getSelection();if(!U(l,a))return!1;if(Q(l))return f.clearText(),!0;if(u.$isRangeSelection(l)){const w=g.$findMatchingParent(l.anchor.getNode(),v=>B(v));if(!B(w))return!1;var n=l.anchor.getNode(),p=l.focus.getNode();n=a.isParentOf(n);p=a.isParentOf(p);if(n&&!p||p&&!n)return f.clearText(),!0;n=(p=g.$findMatchingParent(l.anchor.getNode(),
v=>u.$isElementNode(v)))&&g.$findMatchingParent(p,v=>u.$isElementNode(v)&&B(v.getParent()));if(!u.$isElementNode(n)||!u.$isElementNode(p))return!1;if(k===u.DELETE_LINE_COMMAND&&null===n.getPreviousSibling())return!0;if((k===u.DELETE_CHARACTER_COMMAND||k===u.DELETE_WORD_COMMAND)&&l.isCollapsed()&&0===l.anchor.offset&&p!==n){l=p.getChildren();const v=u.$createParagraphNode();l.forEach(A=>v.append(A));p.replace(v);p.getWritable().__parent=w.getKey();return!0}}return!1};[u.DELETE_WORD_COMMAND,u.DELETE_LINE_COMMAND,
u.DELETE_CHARACTER_COMMAND].forEach(k=>{f.listenersToRemove.add(c.registerCommand(k,t(k),u.COMMAND_PRIORITY_CRITICAL))});b=k=>{const l=u.$getSelection();if(!U(l,a))return!1;if(Q(l))return k.preventDefault(),k.stopPropagation(),f.clearText(),!0;u.$isRangeSelection(l)&&(k=g.$findMatchingParent(l.anchor.getNode(),n=>B(n)),B(k));return!1};f.listenersToRemove.add(c.registerCommand(u.KEY_BACKSPACE_COMMAND,b,u.COMMAND_PRIORITY_CRITICAL));f.listenersToRemove.add(c.registerCommand(u.KEY_DELETE_COMMAND,b,u.COMMAND_PRIORITY_CRITICAL));
f.listenersToRemove.add(c.registerCommand(u.FORMAT_TEXT_COMMAND,k=>{let l=u.$getSelection();if(!U(l,a))return!1;if(Q(l))return f.formatCells(k),!0;u.$isRangeSelection(l)&&(k=g.$findMatchingParent(l.anchor.getNode(),n=>B(n)),B(k));return!1},u.COMMAND_PRIORITY_CRITICAL));f.listenersToRemove.add(c.registerCommand(u.FORMAT_ELEMENT_COMMAND,k=>{var l=u.$getSelection();if(!Q(l)||!U(l,a))return!1;var n=l.anchor.getNode();l=l.focus.getNode();if(!B(n)||!B(l))return!1;let [p,w,v]=O(a,n,l);n=Math.max(w.startRow,
v.startRow);l=Math.max(w.startColumn,v.startColumn);var A=Math.min(w.startRow,v.startRow);let E=Math.min(w.startColumn,v.startColumn);for(;A<=n;A++)for(let G=E;G<=l;G++){var F=p[A][G].cell;F.setFormat(k);F=F.getChildren();for(let L=0;L<F.length;L++){let M=F[L];u.$isElementNode(M)&&!M.isInline()&&M.setFormat(k)}}return!0},u.COMMAND_PRIORITY_CRITICAL));f.listenersToRemove.add(c.registerCommand(u.CONTROLLED_TEXT_INSERTION_COMMAND,k=>{var l=u.$getSelection();if(!U(l,a))return!1;if(Q(l))f.clearHighlight();
else if(u.$isRangeSelection(l)){let n=g.$findMatchingParent(l.anchor.getNode(),p=>B(p));if(!B(n))return!1;if("string"===typeof k&&(l=Ha(c,l,a)))return Ga(l,a,[u.$createTextNode(k)]),!0}return!1},u.COMMAND_PRIORITY_CRITICAL));d&&f.listenersToRemove.add(c.registerCommand(u.KEY_TAB_COMMAND,k=>{var l=u.$getSelection();if(!u.$isRangeSelection(l)||!l.isCollapsed()||!U(l,a))return!1;l=Ba(l.anchor.getNode());if(null===l)return!1;Z(k);l=a.getCordsFromCellNode(l,f.table);ya(f,a,l.x,l.y,k.shiftKey?"backward":
"forward");return!0},u.COMMAND_PRIORITY_CRITICAL));f.listenersToRemove.add(c.registerCommand(u.FOCUS_COMMAND,()=>a.isSelected(),u.COMMAND_PRIORITY_HIGH));f.listenersToRemove.add(c.registerCommand(u.SELECTION_INSERT_CLIPBOARD_NODES_COMMAND,k=>{let {nodes:l,selection:n}=k;k=n.getStartEndPoints();var p=Q(n);p=u.$isRangeSelection(n)&&null!==g.$findMatchingParent(n.anchor.getNode(),I=>B(I))&&null!==g.$findMatchingParent(n.focus.getNode(),I=>B(I))||p;if(1!==l.length||!K(l[0])||!p||null===k)return!1;var [w]=
k,v=l[0];k=v.getChildren();p=v.getFirstChildOrThrow().getChildrenSize();v=v.getChildrenSize();var A=g.$findMatchingParent(w.getNode(),I=>B(I)),E=(w=A&&g.$findMatchingParent(A,I=>H(I)))&&g.$findMatchingParent(w,I=>K(I));if(!B(A)||!H(w)||!K(E))return!1;var F=w.getIndexWithinParent(),G=Math.min(E.getChildrenSize()-1,F+v-1);v=A.getIndexWithinParent();A=Math.min(w.getChildrenSize()-1,v+p-1);p=Math.min(v,A);w=Math.min(F,G);v=Math.max(v,A);F=Math.max(F,G);E=E.getChildren();G=0;let L,M;for(A=w;A<=F;A++){var da=
E[A];if(!H(da))return!1;var ea=k[G];if(!H(ea))return!1;da=da.getChildren();ea=ea.getChildren();let I=0;for(let V=p;V<=v;V++){let W=da[V];if(!B(W))return!1;let Aa=ea[I];if(!B(Aa))return!1;A===w&&V===p?L=W.getKey():A===F&&V===v&&(M=W.getKey());let La=W.getChildren();Aa.getChildren().forEach(X=>{u.$isTextNode(X)&&u.$createParagraphNode().append(X);W.append(X)});La.forEach(X=>X.remove());I++}G++}L&&M&&(k=R(),k.set(l[0].getKey(),L,M),u.$setSelection(k));return!0},u.COMMAND_PRIORITY_CRITICAL));f.listenersToRemove.add(c.registerCommand(u.SELECTION_CHANGE_COMMAND,
()=>{let k=u.$getSelection(),l=u.$getPreviousSelection();if(u.$isRangeSelection(k)){let {anchor:A,focus:E}=k;var n=A.getNode(),p=E.getNode();n=Ba(n);var w=Ba(p),v=!(!n||!a.is(T(n)));p=!(!w||!a.is(T(w)));let F=v!==p,G=v&&p;v=k.isBackward();F?(n=k.clone(),p?n.focus.set(a.getParentOrThrow().getKey(),v?a.getIndexWithinParent():a.getIndexWithinParent()+1,"element"):n.anchor.set(a.getParentOrThrow().getKey(),v?a.getIndexWithinParent()+1:a.getIndexWithinParent(),"element"),u.$setSelection(n),wa(c,f)):G&&
!n.is(w)&&(f.setAnchorCellForSelection(e(n)),f.setFocusCellForSelection(e(w),!0),f.isSelecting||setTimeout(()=>{let {onMouseUp:L,onMouseMove:M}=q();f.isSelecting=!0;m.addEventListener("mouseup",L);m.addEventListener("mousemove",M)},0))}else k&&Q(k)&&k.is(l)&&k.tableKey===a.getKey()&&(n=ha?(c._window||window).getSelection():null)&&n.anchorNode&&n.focusNode&&(p=(p=u.$getNearestNodeFromDOMNode(n.focusNode))&&!a.is(T(p)),w=(w=u.$getNearestNodeFromDOMNode(n.anchorNode))&&a.is(T(w)),p&&w&&0<n.rangeCount&&
(p=u.$createRangeSelectionFromDom(n,c)))&&(p.anchor.set(a.getKey(),k.isBackward()?a.getChildrenSize():0,"element"),n.removeAllRanges(),u.$setSelection(p));if(k&&!k.is(l)&&(Q(k)||Q(l))&&f.tableSelection&&!f.tableSelection.is(l))return Q(k)&&k.tableKey===f.tableNodeKey?f.updateTableTableSelection(k):!Q(k)&&Q(l)&&l.tableKey===f.tableNodeKey&&f.updateTableTableSelection(null),!1;f.hasHijackedSelectionStyles&&!a.isSelected()?xa(c,f):!f.hasHijackedSelectionStyles&&a.isSelected()&&wa(c,f);return!1},u.COMMAND_PRIORITY_CRITICAL));
f.listenersToRemove.add(c.registerCommand(u.INSERT_PARAGRAPH_COMMAND,()=>{var k=u.$getSelection();return u.$isRangeSelection(k)&&k.isCollapsed()&&U(k,a)?(k=Ha(c,k,a))?(Ga(k,a),!0):!1:!1},u.COMMAND_PRIORITY_CRITICAL));return f};exports.getDOMCellFromTarget=sa;exports.getTableObserverFromTableElement=function(a){return a.__lexicalTableSelection}
